---
title: "Data Mining Project 1"
author: "Nicolas Mora"
date: "11/4/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Introduction to Dataset

Data this week comes from the USDA (United States Department of Agriculture). The raw datasets (Excel Sheets) can be found at - https://www.ers.usda.gov/data-products/dairy-data/documentation/#Loc3

### Loading Libraries

This analysis leverages functions from various libraries, loaded below. Also, the settings for not using scientific notation are also loaded here. 

```{r echo=T, results = 'hide', error=FALSE, warning=FALSE, message=FALSE}

library(tidyverse)
library(scales)
library(dplyr)
library(lubridate)
library(lemon)
library(ggpmisc)
library(ggpubr)
library(devtools)
library(reshape2)
library(plotly)
library(ggplot2)

options(scipen=999)

```

### Importing Datasets

```{r echo=T, results = 'hide', error=FALSE, warning=FALSE, message=FALSE}

milkcow_facts <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-01-29/milkcow_facts.csv")

fluid_milk_sales <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-01-29/fluid_milk_sales.csv")

milk_product_facts <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-01-29/milk_products_facts.csv")

clean_cheese <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-01-29/clean_cheese.csv")

state_milk_production <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-01-29/state_milk_production.csv")

```

## Initial Exploration of Dataset


```{r}

#Loads the data in a new window for a tabular visualization of the contents. 
View(milkcow_facts)
View(fluid_milk_sales)
View(milk_product_facts)
view(clean_cheese)
view(state_milk_production)

```


**Milkcow Facts** - this dataset shows yearly values from 1980-2014 for various facts that help understand the milk industry such as average price of cows and average milk per cow.

**Fluid Milk Sales** - this dataset shows the sales for different fluid beverage milk products from 1975-2017.

**Milk Product Facts** - this dataset shows the average yearly consumption in lbs per person for various milk products from 1975-2017.

**Clean Cheese** - this dataset shows the average yearly consumption in lbs per person for various cheese products from 1970-2017.

**State Milk Production** - this dataset shows the total milk production values for each state from 1970-2017

### Summary Statistics for Milkcow Facts

```{r}

summary(milkcow_facts)
print(milkcow_facts)

```
+ Year is incorrectly classified as a numeric type, double. This should not cause any problems unless an analysis where order is important is created. On-the-spot class changes will be done in that case.

### Summary Statistics for Fluid Milk Sales

```{r}

summary(fluid_milk_sales)
print(fluid_milk_sales)

```
+ Year is incorrectly classified as a numeric type, double. This should not cause any problems unless an analysis where order is important is created. On-the-spot class changes will be done in that case.

### Summary Statistics for Milk Product Facts

```{r}

summary(milk_product_facts)
print(milk_product_facts)

```

+ Year is incorrectly classified as a numeric type, double. This should not cause any problems unless an analysis where order is important is created. On-the-spot class changes will be done in that case.

### Summary Statistics for Clean Cheese

```{r}

summary(clean_cheese)
print(clean_cheese)

```

+ Data for Blue cheese is missing for a 12 year period, from 1998-2009
+ Year is incorrectly classified as a numeric type, double. This should not cause any problems unless an analysis where order is important is created. On-the-spot class changes will be done in that case.

### Summary Statistics for State Milk Production

```{r}

summary(state_milk_production)
print(state_milk_production)

```

+ Year is incorrectly classified as a numeric type, double. This should not cause any problems unless an analysis where order is important is created. On-the-spot class changes will be done in that case.

## Cleaning the dataset

The datasets all seem to be in good condition for analyses. No facilitating changes are needed. Any changes will be made with the visualizations.


## Visualizing Distributions for "Fluid Milk Sales" dataset

#### What are the popularity trends for fluid milk types?

```{r fig.height=6, fig.width=12, echo=FALSE}

fluid_milk_sales %>%
  filter(milk_type == "Total Production") %>%
  ggplot(aes(x = pounds)) +
  geom_histogram(bins = 15, show.legend = FALSE) + 
  labs(x = "Pounds", y = "Count" ) + 
  scale_x_continuous()

fluid_milk_sales %>%
  filter(milk_type == "Total Production") %>%
  ggplot(aes(x = year, y = pounds)) +
  geom_line(size = 2) +
  geom_smooth(se = FALSE) +
  scale_x_continuous(breaks = c(1975,1980,1985,1990,1995,2000,2005,2010,2015)) +
  labs(x = "Year", y = "Pounds Sold", title = "Total Pounds of Fluid Milk Sold, 1975-2017 ") +
  theme_classic()


fluid_milk_sales_graph <- fluid_milk_sales %>%
  group_by(milk_type) %>%
  filter(milk_type != "Total Production") %>%
  ggplot(aes(x = year, y = pounds, color = milk_type)) +
  geom_line(size = 1) +
  scale_x_continuous(breaks = c(1975,1980,1985,1990,1995,2000,2005,2010,2015)) +
  scale_y_continuous(breaks = c(0,5000000000,10000000000,15000000000,20000000000,25000000000,30000000000,35000000000)) +
  labs(x = "Year", y = "Pounds Sold", title = "Pounds of Fluid Milk sold by type, 1975-2017") +
  theme_classic()
ggplotly(fluid_milk_sales_graph)


fluid_milk_sales %>%
  filter(milk_type != "Total Production") %>%
  ggplot(aes(x = pounds, y = milk_type, fill = milk_type)) +
  geom_boxplot(show.legend = FALSE) +
  scale_x_continuous() +
  labs(title = "Variability of Milk Type Sales", x = "Pounds", y = "Milk Type") +
  theme_gray()


```


+ Overall fluid milk sales have been on a downward trend since 2010, after nearly 25 years (1985-2010) of consistent sales.
+ The demand for whole milk has declined greatly over the years. Meanwhile, 2% reduced fat milk has been on the rise. In the 1980's, whole milk was dominant while 2% reduced fat milk was in low demand. Now, they are very close in terms of demand, with 2% Reduced fat milk being ahead slightly. One can infer that societal views on fats have lead to a decline in Whole milk sales over time.
+ Whole Milk has seen the most variability compared to other fluid types, indicating that, though popular, it is very inconsistent. Skim milk also has relatively high variability while less popular fluid types have been very consistent in their sales throughout the recorded timeframe.
+ The scatter plot graphic shows us the two most popular liquid milk types and how they have fluctuated in production over the years. Clearly, you could see that the demand for whole milk has declined greatly over the years. Meanwhile, 2% reduced fat milk has been on the rise. In the 1980's, whole milk was dominant while 2% reduced fat milk was in low demand. Now, they are very close in terms of demand, with 2% Reduced fat milk being ahead slightly.


## Visualizing Distributions for "State Milk Production" dataset

#### How is the distribution of milk production from Region/State?


```{r fig.height=6, fig.width=12, echo=FALSE}

state_milk_production %>%
  mutate(state = fct_reorder(state, milk_produced)) %>%
  group_by("state") %>%
  ggplot(aes(x = milk_produced, y = state, fill = region)) +
  geom_boxplot() +
  geom_dotplot(binaxis='x', 
               stackdir='center', 
               dotsize = .1, 
               fill="red") +
  labs(title = "Variability of Milk Production by State", x = "Milk Production in Lbs", y = "State") +
  theme_gray()

state_milk_production %>%
  filter(region == "Mountain") %>%
  group_by(state) %>%
  summarise(mean_milk = mean(milk_produced)) %>%
  ggplot(aes(x = state, y = mean_milk, fill = state)) +
  geom_col() +
  labs(title = "Average Milk production by state, Mountain Region",x = "State", y = "Milk Produced", color = "State") +
  theme_minimal()

state_milk_production %>%
  filter(milk_produced >= 10000000000) %>%
  count(state, vars = year) %>%
  ggplot(aes(x = state, fill = state)) +
  geom_bar() +
  labs(title = "# of Years that production exceeded 10B Lbs, by State",x = "State", y = "Count", color = "State") +
  theme_minimal()

```

+ The boxplot represents the variability of milk production by state, color coded by region. We can see that region is not very important for milk production, the only Region that showcases similar milk production values are the Lake States and Mountain states. One can also easily see that California is by far the largest producer, and the only significant producer in its region.
+ In the following bar graph we can see that while California and the other states are in the same region, they have wildly different milk production values. One can infer that since California is more south it has better conditions for cows to produce milk. 

```{r}

milkcow_facts %>%
  ggplot(aes(x = milk_feed_price_ratio)) +
  geom_histogram(bins = 15, show.legend = TRUE) + 
  labs(x = "Feed Price Ratio", y = "Count" ) 

milkcow_facts %>%
  ggplot(aes(x = milk_per_cow, y = avg_milk_cow_number, color = year)) +
  geom_point() +
  geom_smooth(stat = "smooth", method = "lm") +
  labs(x = "Milk Per Cow", y = "Average Number of Cows", color = "Year") +
  theme_bw()

milkcow_facts %>%
  ggplot(aes(x = milk_per_cow, y = milk_cow_cost_per_animal, color = year)) +
  geom_point() +
  geom_line() +
  geom_smooth(se = FALSE, method = "lm") +
  labs(title = "Yearly Relationship Between Milk Per Cow and Cost Per Animal",x = "Milk Per Cow", y = "Average Cost Per Cow", color = "Year") +
  theme_bw()


```

+ The scatter plot shows the relationship between the milk per cow and number of cows over the years. You can see there is a strong relationship between these two factors over time. Over the years milk per cow has increased, decreasing the number of cows needed.
+ Knowing this, we should assume that a higher yield per cow

